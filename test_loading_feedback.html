<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Feedback Test - Synapse</title>
    <link rel="stylesheet" href="static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>

<body>
    <div class="hud-container">
        <!-- Chat Pane (70%) -->
        <div class="chat-pane">
            <header class="hud-header">
                <h1 class="hud-title">SYNAPSE</h1>
                <p class="hud-subtitle">Loading Feedback Test</p>
                <div class="status-indicators">
                    <div class="connection-status connected" id="connection-status">
                        <span>ONLINE</span>
                    </div>
                    <div class="ai-service-status ready" id="ai-service-status">
                        <span>AI READY</span>
                    </div>
                </div>
            </header>

            <main class="chat-main">
                <div id="chat-log" class="chat-log">
                    <!-- Test messages will be added here -->
                </div>

                <div class="input-section glass-panel">
                    <div class="input-container">
                        <input type="text" id="message-input" class="hud-input" placeholder="Type a test message..."
                            autocomplete="off">
                        <button id="send-button" class="hud-button primary" type="button">
                            <span class="button-icon">â†’</span>
                            SEND
                        </button>
                    </div>
                    <div style="margin-top: 16px; display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="hud-button secondary" onclick="testStreamingIndicator()">Test Streaming</button>
                        <button class="hud-button secondary" onclick="testStreamingError()">Test Error</button>
                        <button class="hud-button secondary" onclick="testConnectionStatus()">Test Connection</button>
                        <button class="hud-button secondary" onclick="testPerformanceNotification()">Test
                            Performance</button>
                        <button class="hud-button secondary" onclick="testSuccessIndicator()">Test Success</button>
                    </div>
                </div>
            </main>
        </div>

        <!-- Cognitive Dashboard (30%) -->
        <div class="cognitive-dashboard">
            <header class="dashboard-header">
                <h2 class="dashboard-title">LOADING STATES TEST</h2>
                <div class="dashboard-controls">
                    <button class="hud-button secondary" onclick="testChartLoading()">Test Charts</button>
                </div>
            </header>

            <div class="dashboard-content">
                <div id="dashboard-content-inner" class="dashboard-content-inner">
                    <!-- Charts Section -->
                    <section class="charts-section">
                        <h3 class="section-title">Chart Loading Tests</h3>
                        <div class="charts-grid">
                            <!-- Core Values Radar Chart -->
                            <div class="chart-container glass-panel" id="core-values-container">
                                <div class="chart-header">
                                    <h4 class="chart-title">Core Values</h4>
                                    <div class="chart-status" id="core-values-status">Ready</div>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="core-values-chart" width="300" height="200"></canvas>
                                </div>
                            </div>

                            <!-- Recurring Themes Bar Chart -->
                            <div class="chart-container glass-panel" id="recurring-themes-container">
                                <div class="chart-header">
                                    <h4 class="chart-title">Recurring Themes</h4>
                                    <div class="chart-status" id="recurring-themes-status">Ready</div>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="recurring-themes-chart" width="300" height="200"></canvas>
                                </div>
                            </div>

                            <!-- Emotional Landscape Doughnut Chart -->
                            <div class="chart-container glass-panel" id="emotional-landscape-container">
                                <div class="chart-header">
                                    <h4 class="chart-title">Emotional Landscape</h4>
                                    <div class="chart-status" id="emotional-landscape-status">Ready</div>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="emotional-landscape-chart" width="300" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <script src="static/js/loading-feedback.js"></script>

    <script>
        // Test functions for loading feedback functionality

        function testStreamingIndicator() {
            const chatLog = document.getElementById('chat-log');

            // Create user message
            const userMessage = document.createElement('div');
            userMessage.classList.add('message', 'user-message');
            userMessage.innerHTML = '<div class="message-content">Test streaming response</div>';
            chatLog.appendChild(userMessage);

            // Create AI response with streaming indicator
            const aiMessage = document.createElement('div');
            aiMessage.classList.add('message', 'ai-message', 'streaming');
            const contentElement = document.createElement('div');
            contentElement.classList.add('message-content');
            aiMessage.appendChild(contentElement);

            // Add streaming indicator
            if (window.loadingFeedbackManager) {
                window.loadingFeedbackManager.createStreamingIndicator(contentElement, 'Testing streaming...');
                window.loadingFeedbackManager.createStreamingProgress(contentElement);
            }

            chatLog.appendChild(aiMessage);
            chatLog.scrollTop = chatLog.scrollHeight;

            // Simulate streaming completion after 3 seconds
            setTimeout(() => {
                contentElement.innerHTML = '';
                const textElement = document.createElement('div');
                textElement.textContent = 'This is a test streaming response that demonstrates the enhanced loading states and user feedback system.';
                contentElement.appendChild(textElement);

                aiMessage.classList.remove('streaming');
                aiMessage.classList.add('streaming-complete');

                if (window.loadingFeedbackManager) {
                    window.loadingFeedbackManager.showSuccessIndicator(aiMessage, 'Streaming completed');
                }
            }, 3000);
        }

        function testStreamingError() {
            const chatLog = document.getElementById('chat-log');

            // Create user message
            const userMessage = document.createElement('div');
            userMessage.classList.add('message', 'user-message');
            userMessage.innerHTML = '<div class="message-content">Test error handling</div>';
            chatLog.appendChild(userMessage);

            // Create AI response with error
            const aiMessage = document.createElement('div');
            aiMessage.classList.add('message', 'ai-message', 'streaming');
            const contentElement = document.createElement('div');
            contentElement.classList.add('message-content');
            aiMessage.appendChild(contentElement);

            // Add streaming indicator first
            if (window.loadingFeedbackManager) {
                window.loadingFeedbackManager.createStreamingIndicator(contentElement, 'Processing...');
            }

            chatLog.appendChild(aiMessage);
            chatLog.scrollTop = chatLog.scrollHeight;

            // Simulate error after 2 seconds
            setTimeout(() => {
                const error = new Error('Connection timeout - this is a test error');
                error.name = 'AbortError';

                if (window.loadingFeedbackManager) {
                    window.loadingFeedbackManager.showStreamingErrorRecovery(contentElement, error, {
                        originalMessage: 'Test error handling'
                    });
                }

                aiMessage.classList.remove('streaming');
                aiMessage.classList.add('streaming-error');
            }, 2000);
        }

        function testConnectionStatus() {
            if (!window.loadingFeedbackManager) return;

            const statuses = ['connecting', 'connected', 'disconnected'];
            let currentIndex = 0;

            const cycleStatus = () => {
                window.loadingFeedbackManager.updateConnectionStatus(statuses[currentIndex]);
                currentIndex = (currentIndex + 1) % statuses.length;

                if (currentIndex !== 0) {
                    setTimeout(cycleStatus, 2000);
                } else {
                    // Reset to connected after cycle
                    setTimeout(() => {
                        window.loadingFeedbackManager.updateConnectionStatus('connected');
                    }, 2000);
                }
            };

            cycleStatus();
        }

        function testPerformanceNotification() {
            if (!window.loadingFeedbackManager) return;

            // Test slow response notification
            window.loadingFeedbackManager.showPerformanceNotification(5500);

            // Test very slow response notification after 3 seconds
            setTimeout(() => {
                window.loadingFeedbackManager.showPerformanceNotification(12000);
            }, 3000);
        }

        function testSuccessIndicator() {
            if (!window.loadingFeedbackManager) return;

            window.loadingFeedbackManager.showSuccessNotification('Test operation completed successfully!');
        }

        function testChartLoading() {
            const chartIds = ['core-values', 'recurring-themes', 'emotional-landscape'];
            const chartTypes = ['radar', 'bar', 'doughnut'];

            chartIds.forEach((chartId, index) => {
                // Dispatch loading started event
                document.dispatchEvent(new CustomEvent('chartLoadingStarted', {
                    detail: {
                        chartId,
                        chartType: chartTypes[index]
                    }
                }));

                // Simulate loading completion after random delay
                const delay = 2000 + Math.random() * 3000;
                setTimeout(() => {
                    if (Math.random() > 0.7) {
                        // Simulate error for some charts
                        document.dispatchEvent(new CustomEvent('chartError', {
                            detail: {
                                chartId,
                                error: new Error('Failed to load chart data - this is a test error')
                            }
                        }));
                    } else {
                        // Simulate successful completion
                        document.dispatchEvent(new CustomEvent('chartLoadingCompleted', {
                            detail: { chartId }
                        }));
                    }
                }, delay);
            });
        }

        // Test AI service status cycling
        function testAIServiceStatus() {
            if (!window.loadingFeedbackManager) return;

            const statuses = ['processing', 'ready', 'error'];
            let currentIndex = 0;

            const cycleStatus = () => {
                window.loadingFeedbackManager.updateAIServiceStatus(statuses[currentIndex]);
                currentIndex = (currentIndex + 1) % statuses.length;

                if (currentIndex !== 0) {
                    setTimeout(cycleStatus, 2000);
                } else {
                    // Reset to ready after cycle
                    setTimeout(() => {
                        window.loadingFeedbackManager.updateAIServiceStatus('ready');
                    }, 2000);
                }
            };

            cycleStatus();
        }

        // Add some initial test messages
        document.addEventListener('DOMContentLoaded', () => {
            const chatLog = document.getElementById('chat-log');

            // Welcome message
            const welcomeMessage = document.createElement('div');
            welcomeMessage.classList.add('message', 'ai-message');
            welcomeMessage.innerHTML = `
                <div class="message-content">
                    Welcome to the Loading Feedback Test! This page demonstrates the enhanced loading states and user feedback system.
                    <br><br>
                    Use the buttons below to test different loading states:
                    <ul style="margin: 8px 0; padding-left: 20px;">
                        <li><strong>Test Streaming:</strong> Shows typing dots and progress indicators</li>
                        <li><strong>Test Error:</strong> Demonstrates error recovery options</li>
                        <li><strong>Test Connection:</strong> Cycles through connection status indicators</li>
                        <li><strong>Test Performance:</strong> Shows performance notifications</li>
                        <li><strong>Test Success:</strong> Displays success confirmation</li>
                        <li><strong>Test Charts:</strong> Demonstrates chart loading skeletons</li>
                    </ul>
                </div>
            `;
            chatLog.appendChild(welcomeMessage);

            // Auto-test AI service status after 2 seconds
            setTimeout(testAIServiceStatus, 2000);
        });
    </script>
</body>

</html>