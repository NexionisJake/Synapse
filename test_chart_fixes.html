<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Fixes Test</title>
    <link rel="stylesheet" href="static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body>
    <div class="container glass-panel-strong" style="max-width: 800px; margin: 2rem auto; padding: 2rem;">
        <header>
            <h1 class="hud-title">Chart Canvas Reuse Fix Test</h1>
            <p class="hud-subtitle">Testing fixes for canvas reuse errors and sample data issues</p>
        </header>
        
        <div class="hud-divider glow"></div>
        
        <main>
            <!-- Charts Section -->
            <section class="charts-section hud-card">
                <div class="section-header">
                    <h2 class="hud-title" style="font-size: 1.2rem; margin: 0;">Core Values Chart</h2>
                    <div style="display: flex; gap: 8px;">
                        <button id="create-chart" class="hud-button primary">Create Chart</button>
                        <button id="recreate-chart" class="hud-button secondary">Recreate Chart</button>
                        <button id="multiple-creates" class="hud-button secondary">Multiple Creates</button>
                    </div>
                </div>
                <div class="charts-grid">
                    <!-- Core Values Radar Chart -->
                    <div class="chart-container glass-panel" id="core-values-container">
                        <div class="chart-header">
                            <h4 class="chart-title">Core Values</h4>
                            <div class="chart-status loading" id="core-values-status">Ready</div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="core-values-chart" width="300" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Test Log -->
            <section class="hud-card" style="margin-top: 2rem;">
                <h3 class="hud-title" style="font-size: 1rem; margin-bottom: 1rem;">Test Log</h3>
                <div id="test-log" style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; color: #C9D1D9; font-family: monospace; font-size: 0.9rem; max-height: 300px; overflow-y: auto;"></div>
            </section>
        </main>
    </div>
    
    <script src="static/js/cognitive-charts.js"></script>
    <script>
        let chartManager;
        let testLog = '';
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            testLog += `[${timestamp}] ${message}\n`;
            document.getElementById('test-log').textContent = testLog;
            document.getElementById('test-log').scrollTop = document.getElementById('test-log').scrollHeight;
            console.log(message);
        }
        
        // Override console.error to capture errors
        const originalError = console.error;
        console.error = function(...args) {
            log('ERROR: ' + args.join(' '));
            originalError.apply(console, args);
        };
        
        document.addEventListener('DOMContentLoaded', () => {
            log('Page loaded, initializing chart manager...');
            
            chartManager = new CognitiveChartManager();
            chartManager.init();
            
            log('Chart manager initialized');
            
            // Bind event handlers
            document.getElementById('create-chart').addEventListener('click', createChart);
            document.getElementById('recreate-chart').addEventListener('click', recreateChart);
            document.getElementById('multiple-creates').addEventListener('click', multipleCreates);
        });
        
        function createChart() {
            log('Creating chart...');
            
            const testData = {
                labels: ['Creativity', 'Stability', 'Learning', 'Curiosity', 'Analysis', 'Empathy'],
                values: [4.2, 3.8, 4.7, 4.5, 3.9, 4.1]
            };
            
            try {
                chartManager.createCoreValuesChart(testData);
                log('Chart created successfully');
            } catch (error) {
                log('Error creating chart: ' + error.message);
            }
        }
        
        function recreateChart() {
            log('Recreating chart (should destroy existing first)...');
            
            const testData = {
                labels: ['Creativity', 'Stability', 'Learning', 'Curiosity', 'Analysis', 'Empathy'],
                values: [Math.random() * 5, Math.random() * 5, Math.random() * 5, Math.random() * 5, Math.random() * 5, Math.random() * 5]
            };
            
            try {
                chartManager.createCoreValuesChart(testData);
                log('Chart recreated successfully');
            } catch (error) {
                log('Error recreating chart: ' + error.message);
            }
        }
        
        function multipleCreates() {
            log('Testing multiple rapid chart creations...');
            
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const testData = {
                        labels: ['Creativity', 'Stability', 'Learning', 'Curiosity', 'Analysis', 'Empathy'],
                        values: [Math.random() * 5, Math.random() * 5, Math.random() * 5, Math.random() * 5, Math.random() * 5, Math.random() * 5]
                    };
                    
                    try {
                        chartManager.createCoreValuesChart(testData);
                        log(`Multiple create ${i + 1} successful`);
                    } catch (error) {
                        log(`Multiple create ${i + 1} error: ${error.message}`);
                    }
                }, i * 100);
            }
        }
    </script>
</body>
</html>