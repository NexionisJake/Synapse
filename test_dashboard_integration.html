<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Integration Test - Synapse</title>
    <link rel="stylesheet" href="static/css/style.css">
    <!-- Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        .test-header {
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid #58A6FF;
            border-radius: 8px;
            padding: 16px;
            margin: 16px;
            text-align: center;
        }
        .test-status {
            margin: 8px 0;
            padding: 8px;
            border-radius: 4px;
        }
        .test-pass {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10B981;
            color: #10B981;
        }
        .test-fail {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #EF4444;
            color: #EF4444;
        }
        .test-info {
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid #58A6FF;
            color: #58A6FF;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1 class="hud-title">Dashboard Integration Test</h1>
        <p class="hud-subtitle">Testing enhanced UI integration with existing dashboard functionality</p>
        <div id="test-results"></div>
    </div>

    <div class="hud-container">
        <!-- Chat Pane (70%) -->
        <div class="chat-pane">
            <header class="hud-header">
                <h1 class="hud-title">SYNAPSE</h1>
                <p class="hud-subtitle">Your AI Cognitive Partner</p>
                <nav class="dashboard-nav">
                    <button class="hud-button secondary" onclick="runTests()">
                        <span class="button-icon">üß™</span>
                        Run Tests
                    </button>
                </nav>
                <div class="status-indicators">
                    <div class="connection-status connected" id="connection-status">
                        <span>TESTING</span>
                    </div>
                    <div class="ai-service-status ready" id="ai-service-status">
                        <span>INTEGRATION TEST</span>
                    </div>
                </div>
            </header>
            
            <main class="chat-main">
                <div id="chat-log" class="chat-log">
                    <div class="message ai-message">
                        <div class="message-content">
                            <p>Welcome to the Dashboard Integration Test!</p>
                            <p>This test verifies that the enhanced UI integrates properly with existing dashboard functionality.</p>
                            <p>Click "Run Tests" to begin the integration tests.</p>
                        </div>
                    </div>
                </div>
                
                <div class="input-section glass-panel">
                    <div class="input-container">
                        <input type="text" id="message-input" class="hud-input" placeholder="Integration test mode..." disabled>
                        <button id="send-button" class="hud-button primary" type="button" disabled>
                            <span class="button-icon">‚Üí</span>
                            SEND
                        </button>
                    </div>
                </div>
            </main>
        </div>
        
        <!-- Cognitive Dashboard (30%) -->
        <div class="cognitive-dashboard">
            <header class="dashboard-header">
                <h2 class="dashboard-title">COGNITIVE ANALYSIS</h2>
                <div class="dashboard-controls">
                    <button class="hud-button secondary" id="refresh-dashboard">
                        <span class="button-icon">‚Üª</span>
                    </button>
                </div>
            </header>
            
            <div class="dashboard-content">
                <!-- Loading state -->
                <div id="loading-state" class="loading-state" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p class="hud-text-secondary">Loading your insights...</p>
                </div>
                
                <!-- Error state -->
                <div id="error-state" class="error-state" style="display: none;">
                    <div class="error-icon">‚ö†Ô∏è</div>
                    <h3 class="hud-text-primary">Unable to load insights</h3>
                    <p id="error-message" class="hud-text-secondary">There was an error loading your cognitive data.</p>
                    <button id="retry-button" class="hud-button primary">
                        <span class="button-icon">‚Üª</span>
                        Try Again
                    </button>
                </div>
                
                <!-- Empty state -->
                <div id="empty-state" class="empty-state" style="display: none;">
                    <div class="empty-icon">üß†</div>
                    <h3 class="hud-text-primary">No insights yet</h3>
                    <p class="hud-text-secondary">Start having conversations to build your cognitive memory.</p>
                </div>
                
                <!-- Dashboard content -->
                <div id="dashboard-content" class="dashboard-content" style="display: block;">
                    <!-- Statistics Overview -->
                    <section class="stats-section hud-card">
                        <h3 class="section-title">Memory Overview</h3>
                        <div class="stats-grid">
                            <div class="stat-card glass-panel glow-hover">
                                <div class="stat-number hud-text-accent" id="total-insights">42</div>
                                <div class="stat-label hud-text-secondary">Insights</div>
                            </div>
                            <div class="stat-card glass-panel glow-hover">
                                <div class="stat-number hud-text-accent" id="total-conversations">15</div>
                                <div class="stat-label hud-text-secondary">Conversations</div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Interactive Charts -->
                    <section class="charts-section">
                        <h3 class="section-title">Cognitive Patterns</h3>
                        <div class="charts-grid">
                            <!-- Core Values Radar Chart -->
                            <div class="chart-container glass-panel" id="core-values-container">
                                <div class="chart-header">
                                    <h4 class="chart-title">Core Values</h4>
                                    <div class="chart-status" id="core-values-status">Ready</div>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="core-values-chart" width="300" height="200"></canvas>
                                </div>
                            </div>
                            
                            <!-- Recurring Themes Bar Chart -->
                            <div class="chart-container glass-panel" id="recurring-themes-container">
                                <div class="chart-header">
                                    <h4 class="chart-title">Recurring Themes</h4>
                                    <div class="chart-status" id="recurring-themes-status">Ready</div>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="recurring-themes-chart" width="300" height="200"></canvas>
                                </div>
                            </div>
                            
                            <!-- Emotional Landscape Doughnut Chart -->
                            <div class="chart-container glass-panel" id="emotional-landscape-container">
                                <div class="chart-header">
                                    <h4 class="chart-title">Emotional Landscape</h4>
                                    <div class="chart-status" id="emotional-landscape-status">Ready</div>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="emotional-landscape-chart" width="300" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Recent Insights -->
                    <section class="insights-section">
                        <h3 class="section-title">Recent Insights</h3>
                        <div id="insights-container" class="insights-container">
                            <div class="insight-card">
                                <div class="insight-header">
                                    <span class="insight-category">Test Data</span>
                                    <span class="insight-confidence">95% confidence</span>
                                </div>
                                <div class="insight-content">Integration test shows all components are properly connected and functioning.</div>
                                <div class="insight-timestamp">Just now</div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>
    
    <script src="static/js/performance-optimizer.js"></script>
    <script src="static/js/streaming-performance-monitor.js"></script>
    <script src="static/js/loading-feedback.js"></script>
    <script src="static/js/error-handlers.js"></script>
    <script src="static/js/cognitive-charts.js"></script>
    <script src="static/js/dashboard.js"></script>
    
    <script>
        // Integration test functions
        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<h3>Running Integration Tests...</h3>';
            
            const tests = [
                testLayoutStructure,
                testChartManager,
                testDashboardIntegration,
                testStreamingIntegration,
                testSerendipityIntegration,
                testBackwardCompatibility
            ];
            
            let results = [];
            
            tests.forEach((test, index) => {
                try {
                    const result = test();
                    results.push(result);
                } catch (error) {
                    results.push({
                        name: `Test ${index + 1}`,
                        status: 'fail',
                        message: `Error: ${error.message}`
                    });
                }
            });
            
            displayResults(results);
        }
        
        function testLayoutStructure() {
            const hudContainer = document.querySelector('.hud-container');
            const chatPane = document.querySelector('.chat-pane');
            const cognitivePanel = document.querySelector('.cognitive-dashboard');
            
            if (hudContainer && chatPane && cognitivePanel) {
                return {
                    name: 'Layout Structure',
                    status: 'pass',
                    message: 'Two-column layout properly implemented'
                };
            } else {
                return {
                    name: 'Layout Structure',
                    status: 'fail',
                    message: 'Missing layout components'
                };
            }
        }
        
        function testChartManager() {
            if (typeof CognitiveChartManager !== 'undefined') {
                const chartManager = new CognitiveChartManager();
                if (chartManager && typeof chartManager.init === 'function') {
                    return {
                        name: 'Chart Manager',
                        status: 'pass',
                        message: 'CognitiveChartManager available and functional'
                    };
                }
            }
            return {
                name: 'Chart Manager',
                status: 'fail',
                message: 'CognitiveChartManager not available or not functional'
            };
        }
        
        function testDashboardIntegration() {
            if (typeof Dashboard !== 'undefined') {
                const dashboard = new Dashboard();
                if (dashboard && typeof dashboard.ensureBackwardCompatibility === 'function') {
                    return {
                        name: 'Dashboard Integration',
                        status: 'pass',
                        message: 'Dashboard class has integration features'
                    };
                }
            }
            return {
                name: 'Dashboard Integration',
                status: 'fail',
                message: 'Dashboard integration features not available'
            };
        }
        
        function testStreamingIntegration() {
            // Check if streaming integration events are set up
            const hasStreamingSupport = typeof StreamingResponseHandler !== 'undefined' ||
                                      document.querySelector('.streaming-indicator') !== null;
            
            if (hasStreamingSupport) {
                return {
                    name: 'Streaming Integration',
                    status: 'pass',
                    message: 'Streaming integration components available'
                };
            } else {
                return {
                    name: 'Streaming Integration',
                    status: 'info',
                    message: 'Streaming components not fully loaded (expected in test mode)'
                };
            }
        }
        
        function testSerendipityIntegration() {
            // Check if serendipity integration is available
            const dashboard = new Dashboard();
            if (dashboard && typeof dashboard.setupSerendipityIntegration === 'function') {
                return {
                    name: 'Serendipity Integration',
                    status: 'pass',
                    message: 'Serendipity integration methods available'
                };
            } else {
                return {
                    name: 'Serendipity Integration',
                    status: 'fail',
                    message: 'Serendipity integration not available'
                };
            }
        }
        
        function testBackwardCompatibility() {
            // Check if existing API endpoints are referenced
            const dashboard = new Dashboard();
            if (dashboard && typeof dashboard.validateAPIEndpoints === 'function') {
                return {
                    name: 'Backward Compatibility',
                    status: 'pass',
                    message: 'Backward compatibility methods available'
                };
            } else {
                return {
                    name: 'Backward Compatibility',
                    status: 'fail',
                    message: 'Backward compatibility not ensured'
                };
            }
        }
        
        function displayResults(results) {
            const resultsDiv = document.getElementById('test-results');
            let html = '<h3>Integration Test Results</h3>';
            
            results.forEach(result => {
                const statusClass = result.status === 'pass' ? 'test-pass' : 
                                  result.status === 'fail' ? 'test-fail' : 'test-info';
                const icon = result.status === 'pass' ? '‚úì' : 
                           result.status === 'fail' ? '‚úó' : '‚Ñπ';
                
                html += `
                    <div class="test-status ${statusClass}">
                        <strong>${icon} ${result.name}</strong>: ${result.message}
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }
        
        // Initialize test charts
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof CognitiveChartManager !== 'undefined') {
                const chartManager = new CognitiveChartManager();
                chartManager.init();
                chartManager.showChartPlaceholders();
            }
        });
    </script>
</body>
</html>